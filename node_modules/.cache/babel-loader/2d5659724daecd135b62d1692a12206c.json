{"ast":null,"code":"import _regeneratorRuntime from\"/Users/ekaterinapavlova/PycharmProjects/onix/ffmpegwasm.github.io/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _toConsumableArray from\"/Users/ekaterinapavlova/PycharmProjects/onix/ffmpegwasm.github.io/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/Users/ekaterinapavlova/PycharmProjects/onix/ffmpegwasm.github.io/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/ekaterinapavlova/PycharmProjects/onix/ffmpegwasm.github.io/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _objectSpread from\"/Users/ekaterinapavlova/PycharmProjects/onix/ffmpegwasm.github.io/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import Grid from'@material-ui/core/Grid';import CircularProgress from'@material-ui/core/CircularProgress';import Box from'@material-ui/core/Box';import Button from'@material-ui/core/Button';import Typography from'@material-ui/core/Typography';import{makeStyles}from'@material-ui/core/styles';import{createFFmpeg,fetchFile}from'@ffmpeg/ffmpeg';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ffmpeg=null;var useStyles=makeStyles({root:{margin:'48px 0px 48px 0px'},progress:{width:'100%'}});var readFromBlobOrFile=function readFromBlobOrFile(blob){return new Promise(function(resolve,reject){var fileReader=new FileReader();fileReader.onload=function(){resolve(fileReader.result);};fileReader.onerror=function(_ref){var code=_ref.target.error.code;reject(Error(\"File could not be read! Code=\".concat(code)));};fileReader.readAsArrayBuffer(blob);});};function CircularProgressWithLabel(props){return/*#__PURE__*/_jsxs(Box,{position:\"relative\",display:\"inline-flex\",children:[/*#__PURE__*/_jsx(CircularProgress,_objectSpread({variant:\"static\"},props)),/*#__PURE__*/_jsx(Box,{top:0,left:0,bottom:0,right:0,position:\"absolute\",display:\"flex\",alignItems:\"center\",justifyContent:\"center\",children:/*#__PURE__*/_jsx(Typography,{variant:\"caption\",component:\"div\",color:\"textSecondary\",children:\"\".concat(Math.round(props.value),\"%\")})})]});}function FFmpeg(_ref2){var args=_ref2.args,inFilename=_ref2.inFilename,outFilename=_ref2.outFilename,mediaType=_ref2.mediaType;var classes=useStyles();var _useState=useState(''),_useState2=_slicedToArray(_useState,2),videoSrc=_useState2[0],setVideoSrc=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),progress=_useState4[0],setProgress=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),message=_useState6[0],setMessage=_useState6[1];useEffect(function(){if(ffmpeg===null){ffmpeg=createFFmpeg({log:true,corePath:'./static/js/ffmpeg-core.js'// corePath: 'https://unpkg.com/@ffmpeg/core@0.8.3/dist/ffmpeg-core.js',\n});}ffmpeg.setLogger(function(_ref3){var type=_ref3.type,message=_ref3.message;if(type!=='info'){setMessage(message);}});ffmpeg.setProgress(function(_ref4){var ratio=_ref4.ratio;if(ratio>=0&&ratio<=1){setProgress(ratio*100);}if(ratio===1){setTimeout(function(){setProgress(0);},1000);}});});var onFileUploaded=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(_ref5){var _ffmpeg;var files,file,start,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:files=_ref5.target.files;_context.t0=Uint8Array;_context.next=4;return readFromBlobOrFile(files[0]);case 4:_context.t1=_context.sent;file=new _context.t0(_context.t1);setMessage('Loading FFmpeg.wasm');if(ffmpeg.isLoaded()){_context.next=11;break;}setMessage('Loading ffmpeg.wasm-core, may take few minutes');_context.next=11;return ffmpeg.load();case 11:_context.t2=ffmpeg;_context.t3=inFilename;_context.next=15;return fetchFile(file);case 15:_context.t4=_context.sent;_context.t2.FS.call(_context.t2,'writeFile',_context.t3,_context.t4);setMessage('Start to run command');start=Date.now();_context.next=21;return(_ffmpeg=ffmpeg).run.apply(_ffmpeg,_toConsumableArray(args));case 21:setMessage(\"Done in \".concat(Date.now()-start,\" ms\"));data=ffmpeg.FS('readFile',outFilename);setVideoSrc(URL.createObjectURL(new Blob([data.buffer],{type:mediaType})));case 24:case\"end\":return _context.stop();}}},_callee);}));return function onFileUploaded(_x){return _ref6.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(Grid,{className:classes.root,container:true,direction:\"column\",alignItems:\"center\",spacing:2,children:[videoSrc.length===0?null:/*#__PURE__*/_jsxs(Grid,{item:true,children:[/*#__PURE__*/_jsx(\"video\",{src:videoSrc,autoPlay:true,controls:true}),\",\"]}),/*#__PURE__*/_jsx(Grid,{item:true,children:progress!==0?/*#__PURE__*/_jsx(CircularProgressWithLabel,{variant:\"static\",color:\"secondary\",value:progress}):/*#__PURE__*/_jsxs(Button,{variant:\"contained\",component:\"label\",color:\"secondary\",children:[\"Upload a Video/Audio File\",/*#__PURE__*/_jsx(\"input\",{type:\"file\",style:{display:'none'},onChange:onFileUploaded})]})}),/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsx(Typography,{align:\"center\",children:\"$ ffmpeg \".concat(args.join(' '))})}),/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsx(Typography,{align:\"center\",children:message})})]});}export default FFmpeg;","map":{"version":3,"names":["React","useState","useEffect","Grid","CircularProgress","Box","Button","Typography","makeStyles","createFFmpeg","fetchFile","ffmpeg","useStyles","root","margin","progress","width","readFromBlobOrFile","blob","Promise","resolve","reject","fileReader","FileReader","onload","result","onerror","code","target","error","Error","readAsArrayBuffer","CircularProgressWithLabel","props","Math","round","value","FFmpeg","args","inFilename","outFilename","mediaType","classes","videoSrc","setVideoSrc","setProgress","message","setMessage","log","corePath","setLogger","type","ratio","setTimeout","onFileUploaded","files","Uint8Array","file","isLoaded","load","FS","start","Date","now","run","data","URL","createObjectURL","Blob","buffer","length","display","join"],"sources":["/Users/ekaterinapavlova/PycharmProjects/onix/ffmpegwasm.github.io/src/components/FFmpeg.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport Grid from '@material-ui/core/Grid';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Box from '@material-ui/core/Box';\nimport Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { createFFmpeg, fetchFile } from '@ffmpeg/ffmpeg';\nlet ffmpeg = null;\n\nconst useStyles = makeStyles({\n  root: {\n    margin: '48px 0px 48px 0px',\n  },\n  progress: {\n    width: '100%',\n  },\n});\n\nconst readFromBlobOrFile = (blob) => (\n  new Promise((resolve, reject) => {\n    const fileReader = new FileReader();\n    fileReader.onload = () => {\n      resolve(fileReader.result);\n    };\n    fileReader.onerror = ({ target: { error: { code } } }) => {\n      reject(Error(`File could not be read! Code=${code}`));\n    };\n    fileReader.readAsArrayBuffer(blob);\n  })\n);\n\nfunction CircularProgressWithLabel(props) {\n  return (\n    <Box position=\"relative\" display=\"inline-flex\">\n      <CircularProgress variant=\"static\" {...props} />\n      <Box\n        top={0}\n        left={0}\n        bottom={0}\n        right={0}\n        position=\"absolute\"\n        display=\"flex\"\n        alignItems=\"center\"\n        justifyContent=\"center\"\n      >\n        <Typography variant=\"caption\" component=\"div\" color=\"textSecondary\">{`${Math.round(\n          props.value,\n        )}%`}</Typography>\n      </Box>\n    </Box>\n  );\n}\n\nfunction FFmpeg({ args, inFilename, outFilename, mediaType }) {\n  const classes = useStyles();\n  const [videoSrc, setVideoSrc] = useState('');\n  const [progress, setProgress] = useState(0);\n  const [message, setMessage] = useState('');\n  useEffect(() => {\n    if (ffmpeg === null) {\n      ffmpeg = createFFmpeg({\n        log: true,\n        corePath: './static/js/ffmpeg-core.js',\n        // corePath: 'https://unpkg.com/@ffmpeg/core@0.8.3/dist/ffmpeg-core.js',\n      });\n    }\n    ffmpeg.setLogger(({ type, message }) => {\n      if (type !== 'info') {\n        setMessage(message);\n      }\n    });\n    ffmpeg.setProgress(({ ratio }) => {\n      if (ratio >= 0 && ratio <= 1) {\n        setProgress(ratio * 100);\n      }\n      if (ratio === 1) {\n        setTimeout(() => { setProgress(0); }, 1000);\n      }\n    });\n  });\n  const onFileUploaded = async ({ target: { files } }) => {\n    const file = new Uint8Array(await readFromBlobOrFile(files[0]));\n    setMessage('Loading FFmpeg.wasm');\n    if (!ffmpeg.isLoaded()) {\n      setMessage('Loading ffmpeg.wasm-core, may take few minutes');\n      await ffmpeg.load();\n    }\n    ffmpeg.FS('writeFile', inFilename, await fetchFile(file));\n    setMessage('Start to run command');\n    const start = Date.now();\n    await ffmpeg.run(...args);\n    setMessage(`Done in ${Date.now() - start} ms`);\n    const data = ffmpeg.FS('readFile', outFilename);\n    setVideoSrc(URL.createObjectURL(new Blob([data.buffer], { type: mediaType })));\n  };\n  return (\n    <Grid className={classes.root} container direction=\"column\" alignItems=\"center\" spacing={2}>\n      {videoSrc.length === 0 ? null : (\n        <Grid item>\n          <video src={videoSrc} autoPlay controls></video>,\n        </Grid>\n      )}\n      <Grid item>\n        {progress !== 0 ? (\n          <CircularProgressWithLabel\n            variant=\"static\"\n            color=\"secondary\"\n            value={progress}\n          />\n        ) : (\n          <Button\n            variant=\"contained\"\n            component=\"label\"\n            color=\"secondary\"\n          >\n            Upload a Video/Audio File\n            <input\n              type=\"file\"\n              style={{ display: 'none' }}\n              onChange={onFileUploaded}\n            />\n          </Button>\n        )}\n      </Grid>\n      <Grid item>\n        <Typography align=\"center\">\n          {`$ ffmpeg ${args.join(' ')}`}\n        </Typography>\n      </Grid>\n      <Grid item>\n        <Typography align=\"center\">\n          {message}\n        </Typography>\n      </Grid>\n    </Grid>\n  );\n}\n\nexport default FFmpeg;\n"],"mappings":"0wBAAA,MAAOA,MAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,MAAOC,KAAP,KAAiB,wBAAjB,CACA,MAAOC,iBAAP,KAA6B,oCAA7B,CACA,MAAOC,IAAP,KAAgB,uBAAhB,CACA,MAAOC,OAAP,KAAmB,0BAAnB,CACA,MAAOC,WAAP,KAAuB,8BAAvB,CACA,OAASC,UAAT,KAA2B,0BAA3B,CACA,OAASC,YAAT,CAAuBC,SAAvB,KAAwC,gBAAxC,C,wFACA,GAAIC,OAAM,CAAG,IAAb,CAEA,GAAMC,UAAS,CAAGJ,UAAU,CAAC,CAC3BK,IAAI,CAAE,CACJC,MAAM,CAAE,mBADJ,CADqB,CAI3BC,QAAQ,CAAE,CACRC,KAAK,CAAE,MADC,CAJiB,CAAD,CAA5B,CASA,GAAMC,mBAAkB,CAAG,QAArBA,mBAAqB,CAACC,IAAD,QACzB,IAAIC,QAAJ,CAAY,SAACC,OAAD,CAAUC,MAAV,CAAqB,CAC/B,GAAMC,WAAU,CAAG,GAAIC,WAAJ,EAAnB,CACAD,UAAU,CAACE,MAAX,CAAoB,UAAM,CACxBJ,OAAO,CAACE,UAAU,CAACG,MAAZ,CAAP,CACD,CAFD,CAGAH,UAAU,CAACI,OAAX,CAAqB,cAAqC,IAAfC,KAAe,MAAlCC,MAAkC,CAAxBC,KAAwB,CAAfF,IAAe,CACxDN,MAAM,CAACS,KAAK,wCAAiCH,IAAjC,EAAN,CAAN,CACD,CAFD,CAGAL,UAAU,CAACS,iBAAX,CAA6Bb,IAA7B,EACD,CATD,CADyB,EAA3B,CAaA,QAASc,0BAAT,CAAmCC,KAAnC,CAA0C,CACxC,mBACE,MAAC,GAAD,EAAK,QAAQ,CAAC,UAAd,CAAyB,OAAO,CAAC,aAAjC,wBACE,KAAC,gBAAD,gBAAkB,OAAO,CAAC,QAA1B,EAAuCA,KAAvC,EADF,cAEE,KAAC,GAAD,EACE,GAAG,CAAE,CADP,CAEE,IAAI,CAAE,CAFR,CAGE,MAAM,CAAE,CAHV,CAIE,KAAK,CAAE,CAJT,CAKE,QAAQ,CAAC,UALX,CAME,OAAO,CAAC,MANV,CAOE,UAAU,CAAC,QAPb,CAQE,cAAc,CAAC,QARjB,uBAUE,KAAC,UAAD,EAAY,OAAO,CAAC,SAApB,CAA8B,SAAS,CAAC,KAAxC,CAA8C,KAAK,CAAC,eAApD,oBAAwEC,IAAI,CAACC,KAAL,CACtEF,KAAK,CAACG,KADgE,CAAxE,OAVF,EAFF,GADF,CAmBD,CAED,QAASC,OAAT,OAA8D,IAA5CC,KAA4C,OAA5CA,IAA4C,CAAtCC,UAAsC,OAAtCA,UAAsC,CAA1BC,WAA0B,OAA1BA,WAA0B,CAAbC,SAAa,OAAbA,SAAa,CAC5D,GAAMC,QAAO,CAAG9B,SAAS,EAAzB,CACA,cAAgCX,QAAQ,CAAC,EAAD,CAAxC,wCAAO0C,QAAP,eAAiBC,WAAjB,eACA,eAAgC3C,QAAQ,CAAC,CAAD,CAAxC,yCAAOc,QAAP,eAAiB8B,WAAjB,eACA,eAA8B5C,QAAQ,CAAC,EAAD,CAAtC,yCAAO6C,OAAP,eAAgBC,UAAhB,eACA7C,SAAS,CAAC,UAAM,CACd,GAAIS,MAAM,GAAK,IAAf,CAAqB,CACnBA,MAAM,CAAGF,YAAY,CAAC,CACpBuC,GAAG,CAAE,IADe,CAEpBC,QAAQ,CAAE,4BACV;AAHoB,CAAD,CAArB,CAKD,CACDtC,MAAM,CAACuC,SAAP,CAAiB,eAAuB,IAApBC,KAAoB,OAApBA,IAAoB,CAAdL,OAAc,OAAdA,OAAc,CACtC,GAAIK,IAAI,GAAK,MAAb,CAAqB,CACnBJ,UAAU,CAACD,OAAD,CAAV,CACD,CACF,CAJD,EAKAnC,MAAM,CAACkC,WAAP,CAAmB,eAAe,IAAZO,MAAY,OAAZA,KAAY,CAChC,GAAIA,KAAK,EAAI,CAAT,EAAcA,KAAK,EAAI,CAA3B,CAA8B,CAC5BP,WAAW,CAACO,KAAK,CAAG,GAAT,CAAX,CACD,CACD,GAAIA,KAAK,GAAK,CAAd,CAAiB,CACfC,UAAU,CAAC,UAAM,CAAER,WAAW,CAAC,CAAD,CAAX,CAAiB,CAA1B,CAA4B,IAA5B,CAAV,CACD,CACF,CAPD,EAQD,CArBQ,CAAT,CAsBA,GAAMS,eAAc,6FAAG,gLAAmBC,KAAnB,OAAS3B,MAAT,CAAmB2B,KAAnB,aACJC,UADI,uBACavC,mBAAkB,CAACsC,KAAK,CAAC,CAAD,CAAN,CAD/B,kCACfE,IADe,8BAErBV,UAAU,CAAC,qBAAD,CAAV,CAFqB,GAGhBpC,MAAM,CAAC+C,QAAP,EAHgB,0BAInBX,UAAU,CAAC,gDAAD,CAAV,CAJmB,uBAKbpC,OAAM,CAACgD,IAAP,EALa,qBAOrBhD,MAPqB,aAOE4B,UAPF,wBAOoB7B,UAAS,CAAC+C,IAAD,CAP7B,+CAOdG,EAPc,kBAOX,WAPW,0BAQrBb,UAAU,CAAC,sBAAD,CAAV,CACMc,KATe,CASPC,IAAI,CAACC,GAAL,EATO,wBAUf,SAAApD,MAAM,EAACqD,GAAP,kCAAc1B,IAAd,EAVe,SAWrBS,UAAU,mBAAYe,IAAI,CAACC,GAAL,GAAaF,KAAzB,QAAV,CACMI,IAZe,CAYRtD,MAAM,CAACiD,EAAP,CAAU,UAAV,CAAsBpB,WAAtB,CAZQ,CAarBI,WAAW,CAACsB,GAAG,CAACC,eAAJ,CAAoB,GAAIC,KAAJ,CAAS,CAACH,IAAI,CAACI,MAAN,CAAT,CAAwB,CAAElB,IAAI,CAAEV,SAAR,CAAxB,CAApB,CAAD,CAAX,CAbqB,uDAAH,kBAAda,eAAc,6CAApB,CAeA,mBACE,MAAC,IAAD,EAAM,SAAS,CAAEZ,OAAO,CAAC7B,IAAzB,CAA+B,SAAS,KAAxC,CAAyC,SAAS,CAAC,QAAnD,CAA4D,UAAU,CAAC,QAAvE,CAAgF,OAAO,CAAE,CAAzF,WACG8B,QAAQ,CAAC2B,MAAT,GAAoB,CAApB,CAAwB,IAAxB,cACC,MAAC,IAAD,EAAM,IAAI,KAAV,wBACE,cAAO,GAAG,CAAE3B,QAAZ,CAAsB,QAAQ,KAA9B,CAA+B,QAAQ,KAAvC,EADF,OAFJ,cAME,KAAC,IAAD,EAAM,IAAI,KAAV,UACG5B,QAAQ,GAAK,CAAb,cACC,KAAC,yBAAD,EACE,OAAO,CAAC,QADV,CAEE,KAAK,CAAC,WAFR,CAGE,KAAK,CAAEA,QAHT,EADD,cAOC,MAAC,MAAD,EACE,OAAO,CAAC,WADV,CAEE,SAAS,CAAC,OAFZ,CAGE,KAAK,CAAC,WAHR,oDAME,cACE,IAAI,CAAC,MADP,CAEE,KAAK,CAAE,CAAEwD,OAAO,CAAE,MAAX,CAFT,CAGE,QAAQ,CAAEjB,cAHZ,EANF,GARJ,EANF,cA4BE,KAAC,IAAD,EAAM,IAAI,KAAV,uBACE,KAAC,UAAD,EAAY,KAAK,CAAC,QAAlB,6BACehB,IAAI,CAACkC,IAAL,CAAU,GAAV,CADf,GADF,EA5BF,cAiCE,KAAC,IAAD,EAAM,IAAI,KAAV,uBACE,KAAC,UAAD,EAAY,KAAK,CAAC,QAAlB,UACG1B,OADH,EADF,EAjCF,GADF,CAyCD,CAED,cAAeT,OAAf"},"metadata":{},"sourceType":"module"}